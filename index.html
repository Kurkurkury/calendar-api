<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Quick Add Kalender</title>
</head>
<body>
<div style="margin:20px">
  <input
    id="text"
    placeholder="z.B. morgen 14:00 Mittagessen 30min"
    style="width:300px;padding:8px"
  />
  <button onclick="send()" style="padding:8px">
    Termin erstellen
  </button>
</div>

<script>
async function send() {
  const text = document.getElementById("text").value;
  if (!text) {
    alert("Bitte Text eingeben");
    return;
  }

  const res = await fetch(
    "https://calendar-api-l9kp.onrender.com/api/google/quick-add",
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": "test123"
      },
      body: JSON.stringify({ text })
    }
  );

  const data = await res.json();
  alert(data.ok ? "Termin erstellt ✅" : "Fehler ❌");
}
</script>

<h2>Termin hinzufügen</h2>

<textarea id="text" rows="3" style="width:100%"
  placeholder="z.B. morgen 14:00 mittagessen 60min"></textarea>

<br><br>

<button onclick="send()">Termin erstellen</button>

<p id="status"></p>

<script>
const API_BASE = "https://calendar-api-l9kp.onrender.com";

async function send() {
  const text = document.getElementById("text").value.trim();
  if (!text) return;

  document.getElementById("status").innerText = "Sende…";

  try {
    const res = await fetch(API_BASE + "/api/google/quick-add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    const data = await res.json();

    if (!res.ok || data.ok === false) {
      throw new Error(data.message || "Fehler");
    }

    const title = data?.parsed?.title;
    const start = data?.parsed?.start;
    const end = data?.parsed?.end;
    const date = start?.split("T")[0];
    const startTime = start?.split("T")[1]?.slice(0, 5);
    const endTime = end?.split("T")[1]?.slice(0, 5);
    const statusMessage =
      title && date && startTime && endTime
        ? `✅ Termin erstellt: ${title} — ${date} ${startTime}-${endTime} (Europe/Zurich)`
        : "✅ Termin erstellt.";
    document.getElementById("status").innerText = statusMessage;
  } catch (e) {
    document.getElementById("status").innerText =
      "❌ Fehler: " + e.message;
  }
}
</script>

</body>
</html>
